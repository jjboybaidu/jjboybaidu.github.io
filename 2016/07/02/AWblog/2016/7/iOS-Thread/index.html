<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>iOS-Thread | 阿汶的博客</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">iOS-Thread</h1><a id="logo" href="/.">阿汶的博客</a><p class="description">知我者谓我心忧 不知我者谓我何求</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">iOS-Thread</h1><div class="post-meta">Jul 2, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h2 id="Thread方案"><a href="#Thread方案" class="headerlink" title="Thread方案"></a>Thread方案</h2><p>1.NSOperation</p>
<p>2.GCD</p>
<p>3.NSThread</p>
<p>4.Thread须知？</p>
<ul>
<li>1.xxx</li>
<li>2.xxx</li>
</ul>
<hr>
<h2 id="Thread-NSThread"><a href="#Thread-NSThread" class="headerlink" title="Thread - NSThread"></a>Thread - NSThread</h2><p>1.NSThread须知？</p>
<ul>
<li>1）NSThread使用的优点和局限</li>
</ul>
<p>2.NSThread使用注意？</p>
<p>3.NSThread常用属性和方法？</p>
<a id="more"></a>
<hr>
<h2 id="Thread-GCD"><a href="#Thread-GCD" class="headerlink" title="Thread - GCD"></a>Thread - GCD</h2><h3 id="1-GCD须知？"><a href="#1-GCD须知？" class="headerlink" title="1.GCD须知？"></a>1.GCD须知？</h3><ul>
<li><p>1）GCD使用的优点和局限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.GCD是苹果公司为多核的并行运算提出的解决方案</span><br><span class="line">2.GCD会自动利用更多的CPU内核（比如双核、四核）</span><br><span class="line">3.GCD会自动管理线程的生命周期（创建线程、调度任务、销毁线程）</span><br><span class="line">4.GCD的高级功能：监视进程或者监视文件夹内文件的变化之类的比较合适。</span><br></pre></td></tr></table></figure>
</li>
<li><p>2）GCD 全称是Grand Central Dispatch，可译为“牛逼的中枢调度器”</p>
</li>
</ul>
<h5 id="GCD-串行、并行、异步、同步"><a href="#GCD-串行、并行、异步、同步" class="headerlink" title="GCD - 串行、并行、异步、同步"></a>GCD - 串行、并行、异步、同步</h5><p>1.什么是串行？</p>
<p>串行就是一个接一个执行，串行是任务A执行完了任务B才能执行, 它们俩只能顺序执行</p>
<p>2.什么是并行？</p>
<p>并行就是多个可以一起执行，并行则是任务A和任务B可以同时执行</p>
<p>3.什么是同步（ dispatch_sync ）？</p>
<ul>
<li><p>1)同步就是，比如用来下载图片的函数A，同步函数只有在image下载结束之后才返回，下载的这段时间函数A只能搬个小板凳在那儿坐等</p>
</li>
<li><p>2)只能在当前线程中执行任务，不具备开启新线程的能力</p>
</li>
</ul>
<p>4.什么是异步（ dispatch_async）？</p>
<ul>
<li><p>1)异步，异步函数, 立即返回,图片会去下载 但函数A不会去等它完成，因此异步函数不会堵塞当前线程去执行下一个函数。</p>
</li>
<li><p>2)可以在新的线程中执行任务，具备开启新线程的能力</p>
</li>
<li><p>3)异步（dispatch_async）是多线程的代名词</p>
</li>
</ul>
<p>5.串行、并行、异步、同步与线程的关系？</p>
<ul>
<li>同步（ dispatch_sync）不会开启新线程，暂停执行所有不以block块任务为第一任务的队列，阻塞</li>
<li>异步（ dispatch_async）不一定会开启新线程，这个跟队列有关，当前线程会直接往下执行，它不会阻塞当前线程</li>
<li>同步执行和异步执行，他们之间的区别主要在于会不会阻塞当前线程,同步会让系统判定暂停执行所有不以block块任务为第一任务的队列（即如果block块任务不在队列头，那么block块任务所在的队列也会暂停执行），且同步一定不会开启新线程，因为GCD觉得既然其它队列暂停执行，block块任务就可以在当前线程执行了，没有必要开启新线程。而异步则系统不会进行判定，但是不一定会开启新线程，这个跟队列有关，如果是新创建的队列，那么GCD就会开启新线程，如果加入已有的队列，那么就会在队列所在的线程中执行。</li>
</ul>
<h5 id="GCD-队列、主队列、全局队列、自定义队列、任务、串行队列、并发队列"><a href="#GCD-队列、主队列、全局队列、自定义队列、任务、串行队列、并发队列" class="headerlink" title="GCD - 队列、主队列、全局队列、自定义队列、任务、串行队列、并发队列"></a>GCD - 队列、主队列、全局队列、自定义队列、任务、串行队列、并发队列</h5><p>1.队列与任务关系?</p>
<ul>
<li>1）队列是用来放置任务的，一个队列可以有很多任务，同时也会有很多队列。</li>
<li>2）所以操作任务的一般步骤是：第一步先确定想做的事情，就是定制任务；第二步是将任务添加到队列中，GCD会自动将队列中的任务取出，放到对应的线程中执行；注意：任务的取出遵循队列的FIFO原则：先进先出，后进后出；</li>
</ul>
<p>2.任务是什么？</p>
<p>任务就是想要做的事，表示执行什么操作</p>
<p>3.队列是什么？</p>
<p>用来存放任务</p>
<p>4.并发队列（Concurrent Dispatch Queue）是什么？</p>
<ul>
<li>1）可以让多个任务并发（同时）执行（自动开启多个线程同时执行任务）</li>
<li>2）并发功能只有在异步（dispatch_async）函数下才有效</li>
<li>3）全局队列就是并发队列</li>
</ul>
<p>5.串行队列（Serial Dispatch Queue）是什么？</p>
<ul>
<li>1）让任务一个接着一个地执行（一个任务执行完毕后，再执行下一个任务）</li>
<li>2）串行和并行是针对同一个队列中的任务而言的，当使用串行，那么队列里的那么队列里的任务最多只能使用一个线程运行，即同一时刻只有一个任务在执行，如果是并行，那么系统会根据队列里的任务自动分配线程执行，最大线程数根据参数设定。</li>
<li>3）主队列就是串行队列</li>
</ul>
<p>6.自定义队列（Serial Dispatch Queue）是什么？</p>
<ul>
<li>1）自定义队列可以是串行队列，也可以是并行队列</li>
</ul>
<h3 id="2-GCD使用注意？"><a href="#2-GCD使用注意？" class="headerlink" title="2.GCD使用注意？"></a>2.GCD使用注意？</h3><h3 id="3-GCD常用属性和方法？"><a href="#3-GCD常用属性和方法？" class="headerlink" title="3.GCD常用属性和方法？"></a>3.GCD常用属性和方法？</h3><p>1.dispatch_sync// 同步执行</p>
<p>2.dispatch_async// 异步执行</p>
<p>3.dispatch_once_t// 保证某段代码在程序运行过程中只被执行1次</p>
<p>4.dispatch_after// 延时</p>
<p>5.dispatch_group_async// 组异步</p>
<p>6.dispatch_suspend// 挂起</p>
<p>7.dispatch_resume// 继续</p>
<p>8.dispatch_barrier_async//  作用是在并行队列中，等待前面的队列执行完成后在继续往下执行</p>
<p>9.dispatch_queue_t// 队列</p>
<p>10.dispatch_apply</p>
<p>11.[NSThread sleepForTimeInterval:1.0]; //线程休眠,等同于sleep(1)</p>
<p>12.dispatch_queue_t queue = dispatch_get_main_queue(); // 创建主队列</p>
<h3 id="4-GCD-Dispatch-Source函数"><a href="#4-GCD-Dispatch-Source函数" class="headerlink" title="4.GCD - Dispatch Source函数"></a>4.GCD - Dispatch Source函数</h3><p>1.Dispatch Source函数须知？</p>
<ul>
<li>1）Source 可以理解为产生事件的地方，Source 产生事件，然后 Source 的回调函数负责 处理这些事件。</li>
<li>2）iOS 中有两种 Source，一种是 Run Loop Source ,一种是 Dispatch Source。</li>
<li>3）在 Run Loop 中， Run Loop Source 产生事件，之后唤醒 Run Loop， Run Loop 便执行该 Source 的回调函数。</li>
<li>4）Dispatch Source 也会产生一些特定的事件，当这些事件发生的时候，其回调的 block （响应句柄）会自动加入到 对应的 dispatch queue 中。</li>
</ul>
<p>2.Dispatch Source 种类</p>
<ul>
<li>DISPATCH_SOURCE_TYPE_TIMER             定时器</li>
<li>DISPATCH_SOURCE_TYPE_SIGNAL            接收到 UNIX 信号</li>
<li>DISPATCH_SOURCE_TYPE_READ              文件可读</li>
<li>DISPATCH_SOURCE_TYPE_WRITE             文件可写</li>
<li>DISPATCH_SOURCE_TYPE_VNODE             文件系统有变更</li>
<li>DISPATCH_SOURCE_TYPE_PROC              与进程相关的事件</li>
<li>DISPATCH_SOURCE_TYPE_MACH_SEND Mach    端口发送事件</li>
<li>DISPATCH_SOURCE_TYPE_MACH_RECV Mach    端口接收事件</li>
<li>DISPATCH_SOURCE_TYPE_DATA_ADD          用户自定义的事件－变量相加</li>
<li>DISPATCH_SOURCE_TYPE_DATA_OR           用户自定义的事件－变量相或</li>
</ul>
<p>3.选择Dispatch Source还是dispatch_async？</p>
<ul>
<li>1）Dispatch Source优势是可以利用联结dispatch_source_merge_data</li>
</ul>
<p>4.Dispatch Source常用属性和方法？</p>
<p>dispatch_source_create//创建</p>
<hr>
<h2 id="Thread-NSOperation"><a href="#Thread-NSOperation" class="headerlink" title="Thread - NSOperation"></a>Thread - NSOperation</h2><h3 id="1-NSOperation须知？"><a href="#1-NSOperation须知？" class="headerlink" title="1.NSOperation须知？"></a>1.NSOperation须知？</h3><ul>
<li>1）NSOperation使用的优点和局限</li>
</ul>
<h3 id="2-NSOperation使用注意？"><a href="#2-NSOperation使用注意？" class="headerlink" title="2.NSOperation使用注意？"></a>2.NSOperation使用注意？</h3><p>1.为什么在并发情况下需要自己来设定isExecuting和isFinished这两个状态量呢?</p>
<ul>
<li>1)为什么在并发情况下需要自己来设定isExecuting和isFinished这两个状态量呢?</li>
<li>2)因为在并发情况下系统不知道operation什么时候finished, operation里面的task一般来说是异步执行的</li>
<li>3)也就是start函数返回了operation不一定就是finish了, 这个你自己来控制, 你什么时候将isFinished置为YES(发送相应的KVO消息), operation就什么时候完成了</li>
<li>4)修改的方法：willChangeValueForKey  /  didChangeValueForKey</li>
</ul>
<h3 id="3-NSOperation常用属性和方法？"><a href="#3-NSOperation常用属性和方法？" class="headerlink" title="3.NSOperation常用属性和方法？"></a>3.NSOperation常用属性和方法？</h3><ul>
<li><p>-(void)start;//启动任务,默认在当前队列同步执行；当实现了start方法时，默认会执行start方法，而不执行main方法</p>
</li>
<li><p>-(void)main;//main函数执行完成后, isExecuting会被置为NO, 而isFinished则被置为YES.</p>
</li>
<li><p>-(void)addDependency:(NSOperation *)op;//依赖可以跨队列依赖</p>
</li>
<li><p>-(void)removeDependency:(NSOperation *)op;</p>
</li>
<li><p>-(void)cancel;//取消任务，GCD没有这个功能</p>
</li>
<li><p>-(void)waitUntilFinished ;</p>
</li>
<li><p>-(void)addExecutionBlock:(void (^)(void))block;//参考《NSOperation【子类1：NSBlockOperation】》</p>
</li>
<li><p>-(nullable instancetype)initWithTarget:(id)target selector:(SEL)sel object:(nullable id)arg;</p>
</li>
<li><p>-(instancetype)initWithInvocation:(NSInvocation *)inv NS_DESIGNATED_INITIALIZER;</p>
</li>
<li><p>-(void)addOperation:(NSOperation *)op;</p>
</li>
<li><p>-(void)addOperations:(NSArray<nsoperation *=""> *)ops waitUntilFinished:(BOOL)wait ;</nsoperation></p>
</li>
<li><p>-(void)addOperationWithBlock:(void (^)(void))block ;</p>
</li>
<li><p>-(void)cancelAllOperations;//取消队列中所有的任务</p>
</li>
<li><p>-(void)waitUntilAllOperationsAreFinished;//阻塞当前线程直到此队列中的所有任务执行完毕</p>
</li>
<li><p>+(nullable NSOperationQueue *)currentQueue ;</p>
</li>
<li><p>+(NSOperationQueue *)mainQueue ;//获取主队列</p>
</li>
<li><p>+(instancetype)blockOperationWithBlock:(void (^)(void))block;</p>
</li>
<li><p>@property NSInteger maxConcurrentOperationCount;//最大并发数;用来设置最多可以让多少个任务同时执行;为 1 时为串行；主对列默认是串行队列</p>
</li>
<li><p>@property (readonly) NSUInteger operationCount;//获取队列的任务数</p>
</li>
<li><p>@property (readonly, getter=isCancelled) BOOL cancelled;//取消；用KVO可以方便的监测NSOperation的状态(isExecuted, isFinished, isCancelled)</p>
</li>
<li><p>@property (readonly, getter=isExecuting) BOOL executing;//正在执行；因为都起了别名，所以可以通过 isExecuting 来 getter 属性值</p>
</li>
<li><p>@property (readonly, getter=isFinished) BOOL finished;//完成</p>
</li>
<li><p>@property (getter=isSuspended) BOOL suspended;//暂停;[queue setSuspended:YES];是重写 set 方法</p>
</li>
</ul>
<h4 id="NSOperationQueuePriority"><a href="#NSOperationQueuePriority" class="headerlink" title="NSOperationQueuePriority"></a>NSOperationQueuePriority</h4><ul>
<li>NSOperationQueuePriorityVeryLow = -8L,</li>
<li>NSOperationQueuePriorityLow = -4L,</li>
<li>NSOperationQueuePriorityNormal = 0,</li>
<li>NSOperationQueuePriorityHigh = 4,</li>
<li>NSOperationQueuePriorityVeryHigh = 8</li>
</ul>
<h4 id="参考连接"><a href="#参考连接" class="headerlink" title="参考连接"></a>参考连接</h4><p>1.<a href="http://www.jianshu.com/p/c56b614db49d" target="_blank" rel="external">http://www.jianshu.com/p/c56b614db49d</a></p>
<p>2.<a href="http://alex1212112.github.io/blog/2015/11/24/dispatch-source/" target="_blank" rel="external">http://alex1212112.github.io/blog/2015/11/24/dispatch-source/</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="williamliuwen.cn/2016/07/02/AWblog/2016/7/iOS-Thread/" data-id="cirty0ytt000ouji0mkbpr41h" class="article-share-link">Aktie</a><div class="tags"></div><div class="post-nav"><a href="/2016/07/09/AWblog/2016/7/iOS-Notification/" class="pre">iOS-Notification</a><a href="/2016/06/09/AWblog/2016/6/iOS-Block/" class="next">iOS-Block</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="williamliuwen.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/23/AWblog/2016/7/iOS-RunLoop/">iOS-RunLoop</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/12/AWblog/2016/7/iOS-数据持久化/">iOS-数据持久化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/09/AWblog/2016/7/iOS-RunTime/">iOS-RunTime</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/09/AWblog/2016/7/iOS-Notification/">iOS-Notification</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/02/AWblog/2016/7/iOS-Thread/">iOS-Thread</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/09/AWblog/2016/6/iOS-Block/">iOS-Block</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/04/AWblog/2016/6/iOS分类-协议-扩展-代理-数据源/">iOS分类/协议/扩展/代理/数据源</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/03/AWblog/2016/6/iOS最佳实践/">iOS最佳实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/23/AWblog/2016/4/hexo-部署/">hexo 部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/12/AWblog/2016/4/iOS-AddressBook-AddressBookUI-Contacts/">iOS-AddressBook/AddressBookUI/Contacts</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">阿汶的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>